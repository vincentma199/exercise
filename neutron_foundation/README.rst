老师，问个问题，现在用vxlan，而不用vlan的原因，除了vlan有4096的限制，还有什么原因啊？
---------------

你好，这个问题简答来说。除了vlan id数量的限制，还有两个原因:一个就是降低交换机的mac地址表的大小。
如果用vlan的话，交换机需要存所有的“mac-vlan-出接口”的关系，硬件交换机的内存都是很宝贵的。如果用
vxlan的话，一个计算节点的所有流量都封装在vtep的mac地址里面，交换机只需要存计算节点的
“mac-vlan-出接口”，这样节省了硬件交换机的内存。

举个例子，如果有100个服务器，每个服务器有20个虚机，如果用vlan，交换机要存2000个条目。但是用
vxlan，只需要存100个条目。

另一个原因是提供L3之上的L2网络，这样，网虚拟机发生迁移的时候，更加方便。例如，在实际中，有两个机架，
一个是vlan100，另一个是vlan200，虚机如果从一个机架迁移到另一个机架，可能要涉及到ip地址，网关的变化。
但是用vxlan的话，可以在这两个机架的网络上提供一个vxlan网络，例如vxlan1000，这样虚机迁移的时候，
不需要做任何改变。

但是也不用盲目迷行vxlan，在国内的实际案例里面，规模不大的私有云，仍然是使用vlan居多。

虚机访问东西流量往往会部署VXLAN，南北流量则可能不希望它走VXLAN，这样我们是不是应该部署两块网卡（流量分开走），一块（东西）指向VTEP，一块指向传统三层网关（不封装vxlan）？
--------

这样可以，实际中也见过这样规划虚机网络的。如果所有虚机在部署的时候都加两块网卡，这样你的私有云里面相当于规划了两个二层网络。

但是如果是多vxlan的场景，一般是虚机只有一块网卡，虚机都连接到路由器，通过路由器出外网。router北向会剥离vxlan标签，南向可以作为多个vxlan网络的网关设备。

对走vxlan的应该要作为vtep吧？
------------

是的，openstack neutron 是这样实现的，虚机的网卡挂在ovs网桥（br-int）上，br-int与另一个网桥br-tun连接，vtep挂在br-tun上。
br-tun也是一个网桥，其实vtep也可以挂在br-int上，例如openstack里面另一个网络项目dragonflow，就是将vtep挂在br-int上。neutron是为了区分做了两个网桥。

br-tun是需要单独部署在一台主机上的？还是和普通的网桥br-int部署在一起的？
-------------

必须要在一个主机上，这样才能相互连接

我不小心把虚拟机的eth0移动到自己创建的命名空间了。用的命令：ip link set dev eth0 netns mynetns
-----------

ip netns exec mynetns ip link set eth0 netns 1
这样应该可以将网卡移回来
